<div class="row">
	{% verbatim %}
	<form class="form-inline" role="form">
		<!-- 先檢查客戶, 或是勾選無客戶在進行刷產編 -->
		<div ng-show="custom.allowNull != 1" class="form-group" ng-class="{'has-success has-feedback': custom.isExist == 1 || custom.allowNull == 1}" >
			<input 
				type="email" 
				class="form-control " 
				placeholder="客戶信箱 ( Enter ) "
				ng-model="custom.email" 
				my-enter="getCustomByMail(custom.email)" 		
			/><!-- angualr 會根據type 過濾值 -->
			<span ng-show="custom.isExist == 1" class="glyphicon glyphicon-ok form-control-feedback"></span>
		</div>

	  <div class="form-group" ng-show="custom.isExist == 1 || custom.allowNull == 1;">
	    <input my-enter="get(barcode);" ng-model="barcode" type="text" class="form-control" placeholder="產編" />
	  </div>

	  <div class="checkbox">
	    <label>
	      <input type="checkbox" ng-model="custom.allowNull" ng-change="setCustomToNull();"/>客戶暫無資料
	    </label>
	  </div>

	  <button type="button" class="btn btn-primary" ng-show="goodsRepo.length > 0;" ng-click="pay();">結帳</button>
	</form>
	<br>
	<br>

	<accordion close-others="oneAtATime">
    <accordion-group 
    	ng-repeat="goods in goodsRepo" 
    	heading="{{ goods.name }}  {{ goods.sn }}  一般價:{{ goods.fake_price }}  優惠價:{{ goods.price }} "
    	is-open="status.isFirstOpen" 
    	is-disabled="status.isFirstDisabled"
    >
      <form class="form-horizontal" role="form">
				<div class="form-group">
					<label class="col-sm-2 control-label">售價</label>

					<div class="col-sm-10">
						<input type="number" class="form-control" ng-model="goods.orders.required" readonly />
					</div>
				</div>

				<my-form-number model="goods" label="'折扣'" name="'discount'" isPrice="1" isRequired="1" on-change="changeDiscount(goods)" ></my-form-number>

				<div class="form-group">
					<label class="col-sm-2 control-label">已付</label>

					<div class="col-sm-10">
						<input type="number" class="form-control" ng-model="goods.orders.paid" />
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-sm-2 control-label">付費方式</label>

					<div class="col-sm-10">
						<select name="payType" class="form-control" 
							ng-model="goods.orders.pay_type" 
							ng-options="payType.id as payType.name for payType in payTypes"></select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">種類</label>

					<div class="col-sm-10">
						<select name="kind" class="form-control" ng-model="goods.orders.kind"
							ng-options="ordersKind.id as ordersKind.name for ordersKind in ordersKinds"
						></select>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">訂單備註</label>

					<div class="col-sm-10">
						<textarea class="form-control" ng-model="goods.orders.memo" ></textarea>
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-2 control-label">&nbsp;</label>

					<div class="col-sm-10">
						<button class="btn btn-default" ng-click="cancel(goods);">取消</button>
					</div>
				</div>
	    </form>
    </accordion-group>
  </accordion>

	<!--/ 有空改寫成一個 directive!!!! -->
	<msg-footer success="successMsg" error="errorMsg"></msg-footer>

	<div class="row" ng-repeat="orders in ordersGroup">
		<h4 class="pointer"
			ng-click="switchDisplay(orders);" 
			ng-class="{dropup: !orders.isDisplay}" 
		>
			<span class="caret"></span>
			<span bind-once>{{ orders.kind.name }} 
				<small>{{ orders.status.name }}</small>
				&nbsp;&nbsp;
			</span>
			<b>{{ orders.goods_passport.name }}&nbsp;&nbsp;</b>
			<i bind-once>{{ orders.goods_passport.sn }}&nbsp;&nbsp;</i>
			<span>{{ orders.custom.name }}</span>
			<span class="pull-right small-font" bind-once>應付:&nbsp;{{ orders.required }}&nbsp;&nbsp;</span>
			<span class="pull-right small-font" bind-once>已付:&nbsp;{{ orders.paid }}&nbsp;&nbsp;</span>
			<span class="pull-right small-font" bind-once ng-show="orders.goods_passport.discount && orders.goods_passport.discount != 10;">[{{ orders.goods_passport.discount }}折]&nbsp;&nbsp;</span>
		</h4><hr/>
		
		<tabset justified="true" ng-show="orders.isDisplay">
	    <tab heading="補款">
	    	<form novalidate class="form-horizontal" role="form">
		    	<br />
		    	<br />
					
					<my-form-textarea model="orders" label="'訂單備註'" name="'memo'"></my-form-textarea>
		    	<my-form-span model="orders" label="'應付'" name="'required'"></my-form-span>
					<my-form-span model="orders" label="'已付'" name="'paid'"></my-form-span>
					<my-form-number ng-show="orders.status.id == 1;" model="orders" label="'補付'" name="'diff'" isPrice="1" isRequired="1"></my-form-number>
					<my-form-select model="orders" entitys="payTypes" name="'pay_type'" label="'付費方式'"></my-form-select>
					
					<my-form-input model="orders" name="'content'" label="'操作備註'"></my-form-input>

					<div class="form-group">
						<label class="col-sm-2 control-label">&nbsp;</label>

						<div class="col-sm-10">
							<button ng-show="orders.status.id != 3;" confirmed-click="_cancel($index);" ng-confirm-click="確定取消此訂單嘛?" class="btn btn-danger">取消訂單</button>
							<button ng-show="orders.status.id == 1;" ng-click="update($index);" class="btn btn-success">確認補付金額</button>
						</div>	
					</div>
				</form>

				<hr/>
	    </tab>

	    <tab heading="歷程記錄">
	    	<br />
	    	<br />

				<div class="panel panel-info" ng-repeat="ope in orders.opes">
				  <div class="panel-heading">
				    <h3 class="panel-title">
				    	<span>{{ ope.user.username }}</span>
				    	<small>-{{ formatDate(ope.create_at) }}</small>
				    </h3>
				  </div>

				  <!-- OK!! 有些沒有資料是因為一開始建檔沒建好 -->
				  <div class="panel-body">
				  	
				    <b>{{ ope.pay_type.name }}</b>{{ ope.money }}元 
						
						<span ng-show="ope.content.length > 0;" class="pull-right">{{ ope.content }}</span>
				  </div>
				</div>

				<hr/>
	    </tab>
	  </tabset>
	</div>
	<!-- 有空改寫成一個 directive!!!! /-->
	{% endverbatim %}

</div>


